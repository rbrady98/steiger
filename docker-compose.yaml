name: metrics-test
services:
  steiger:
    build: .
    ports:
      - 8080:8080
    volumes:
      - ".:/app"

  alloy:
    image: grafana/alloy:latest
    volumes:
      - "./infra/alloy/alloy:/etc/alloy/config.alloy"
    command: [
      "run",
      "--server.http.listen-addr=0.0.0.0:12345",
      "--stability.level=public-preview",
      "/etc/alloy/config.alloy",
    ]

  mimir:
    image: grafana/mimir:latest
    command: ["-ingester.native-histograms-ingestion-enabled=true", "-config.file=/etc/mimir.yaml"]
    volumes:
      - "./infra/mimir/mimir.yaml:/etc/mimir.yaml"

  grafana:
    image: grafana/grafana:latest
    ports: 
      - 3000:3000
    volumes: 
      - ./tmp/grafana:/var/lib/grafana
